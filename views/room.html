<!DOCTYPE html>
<html lang="en">
<head>
	<title>${room.name} - OsomTalk</title>
	<meta name="viewport" content="width = device-width">
	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
	
	<style>
	body {
		padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
	}

	.previews{
		text-align: center;
	}
	.image_preview{
		max-height: 100%;
		overflow: hidden;
		margin:5px;

	}

	.flex-video {
		position: relative;
		padding-top: 25px;
		padding-bottom: 67.5%;
		height: 0;
		margin-bottom: 16px;
		overflow: hidden;
	}
	.message{
		word-wrap:break-word;
	}

	.flex-video.widescreen { padding-bottom: 57.25%; }
	.flex-video.vimeo { padding-top: 0; }

	.flex-video iframe,
	.flex-video object,
	.flex-video embed {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}
	@media only screen and (max-device-width: 800px), only screen and (device-width: 1024px) and (device-height: 600px), only screen and (width: 1280px) and (orientation: landscape), only screen and (device-width: 800px), only screen and (max-width: 767px) {
		.flex-video { padding-top: 0; }
	}
	.footer {
		text-align: center;
	}
	</style>

{{if user == false }}
	<script>
		$(document).ready(function(){
			$('#username').bind('keypress', function(e) {
				if (e.keyCode == 13) {
					takeName();
					e.preventDefault();
				}
			});
		});
		
		function takeName() {
			var username = $("#username").val();
			$.ajax({
				url: '/user/take/',
				data: {username: username},
				success: function(data) {
					if(data.error) {
						if (data.error=="NAME_TAKEN") {
							$('#alert_place_holder').html('<div class="alert"><button type="button" class="close" data-dismiss="alert">×</button><strong>Warning!</strong> Mmmm...that name is already taken.</div>');
						} else if(data.error=="TOO_LONG"){
							$('#alert_place_holder').html('<div class="alert"><button type="button" class="close" data-dismiss="alert">×</button><strong>Warning!</strong> That username is too long, the limit is 20 chars</div>');	
						} else if(data.error=="EMPTY"){
							$('#alert_place_holder').html('<div class="alert"><button type="button" class="close" data-dismiss="alert">×</button><strong>Warning!</strong> Your name is empty and you should feel bad</div>');
						} else if(data.error=="CHEATER"){
							$('#alert_place_holder').html('<div class="alert"><button type="button" class="close" data-dismiss="alert">×</button><strong>Warning!</strong> I see what you did there</div>');
						}

						$('#alert_place_holder').fadeIn();
						setTimeout(function() {
							$('#alert_place_holder').fadeOut();
						} , 3000); 
					} else {
						location.reload();
					}	
				}
			});
		};
	</script>
{{/if}}

<link href="/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">

<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="shortcut icon" href="/img/favicon.png">
</head>   
<body>
	<span class="hide" id="room_id">${room.id}</span>
	<div class="container">
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="/">OsomTalk</a>
					<div class="nav-collapse collapse">
						<ul class="nav">
							<li><a href="/">Home</a></li>
							<li><a href="/about">About</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
		<div class="room-header row">
			<h1 class="span5 pull-left">${room.name}</h1>
			<form  class="sharing span5 pull-right" style="text-align:right">
				Give your friends this link to invite them to this room:<br/>
				<input  class="input-xlarge" style="font-size:30px; height:1.1em" type="text" value="${frontEndConfig.url}/room/${room.id}" onclick="this.select();"/>
			</form>
		</div>
		
		<div id="alert_place_holder"></div>
		<div id="toTop" class="btn"><i class="icon-arrow-up"></i></div>

		<div class="row-fluid clearfix">
			{{if user == false }}
			<h2 class="row-fluid offset2 span8">Please login to continue...</h2>
			<div class="row-fluid offset2 span8">
				<div class="span5" style="text-align:center">
					<br/>
					<a href="/auth/twitter" class="btn btn-primary btn-large">Login with Twitter</a>
				</div>
				<div class="span2" style="text-align:center">
					<br/>
					<h2>OR</h2>
				</div>
				<form id="username_div"class="span5 validate">
					<p>Choose an Anonymous Nickname:</p>
					<input type="text" name="username" id="username" placeholder="" class="span12"/><br/>
					<a href="#" onclick="takeName();" class="pull-right btn btn-primary btn-medium">Login</a>
				</form>
			</div>
			{{else}}			
			<div class="span4">
				<h3>${user.username}</h3>
				<div id="utility_div">
					<form class="form-inline">
						<input type="hidden" name="token" id="token" value="${user.token}"/>
						<input type="hidden" name="identifier" id="identifier" value="${user.identifier}"/>
						<label for="epiceditor">Write your Message:</label>
						<div id="epiceditor"></div>
						<input type="button" href="#" onclick="editor.send();" class="btn btn-primary btn-block" value="Send Message" />
					</form>
					<ul>
						<li><small><code>ALT+ENTER</code> to send your message.</small></li>
						<li><small>Try some more <a href="#shortcutsModal" role="button" data-toggle="modal">shortcuts</a> to chat like a boss.</small></li>
						<li><small>Uses <a href="#markdownModal" role="button" data-toggle="modal">Markdown's Syntax</a>.</small></li>
						<li><small>Want to share an image from your computer?, try <a target="_blank" href="http://imgur.com">imgur.com</a>.</small></li>
					</ul>
				</div>

				<div class="row-fluid">
					<div class="row-fluid toggles">
						
						<div class="group">
							<label>Notifications:</label>
							<div id="notifications_button" class="btn-group" data-toggle="buttons-radio">						
		  						<button type="button" class="btn btn-small btn-success" value="1">On</button>
		  						<button type="button" class="btn btn-small btn-inverse"value="0">Off</button>
							</div>
						</div>
						<div class="group">
							<label>Media:</label>
							<div id="previews_button" class="btn-group" data-toggle="buttons-radio">
								<button type="button" class="btn btn-small btn-success" value="1">On</button>
		  						<button type="button" class="btn btn-small btn-inverse" value="0">Off</button>
							</div>
						</div>
						<!--
						<button id="notifications_button" type="button" class="btn btn-inverse"><i class="icon-exclamation-sign icon-white"></i> Show Notifications</button>-->
					</div>
				</div>

				<div class="row-fluid users_container">

					<h3>Connected Users:</h3>
					<div id="users"></div>
				</div>

			</div> 

			<div class="span8 messages_container">
				<h3>Messages:</h3>
				<div id="messages"></div>
			</div>
			{{/if}}
		</div>
		<hr/>
		<div class="row footer">
			OsomTalk is an <a href="http://www.gnu.org/philosophy/free-sw.html" title="FreeSoftware Fundation">FreeSoftware</a> project availabe as <a href="http://en.wikipedia.org/wiki/Software_as_a_service" title="Wikipedia's definition">SaaS</a> made at <a href="http://hackergarage.mx/" title="HackerGarage Home Page">HackerGarage</a>.<br/>

			<a href="https://github.com/hackergarage/osomtalk" title="OsomTalk Code Repository">Get The Source!</a>
		</div>
	</div><!--Container -->

	<!-- Shortcut Modal -->
	<div id="shortcutsModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Shortcuts, Shortcuts everywhere.</h3>
		</div>
		<div class="modal-body">
			<ul>
				<li><code>ESC</code> Exit the message editor.</li>
				<li><code>N</code> Go back into the message editor.</li>

				<li>Inside the message editor:
					<ul>
						<li><code>ALT+P</code> switch between preview and edit.</li>
						<li><code>ALT+F</code> a pretty nice fullscreen editor.</li>
						<li><code>ALT+ENTER</code> send your message.</li>
					</ul>
				</li>
				<li>Outside the message editor:
					<ul>
						<li><code>T</code> go back to the top.</small></li>
						<li><code>J</code>,<code>K</code>,<code>L</code> to Previous, Next and Love.<small>(not implemented yet)</small></li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		</div>
	</div>

	<!-- markdown Modal -->
	<div id="markdownModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">The Awesome Markdown Syntax</h3>
		</div>
		<div class="modal-body">
			<p><strong>OsomTalk</strong> uses what is called Markdown, a way of write your messages that will automagically turn into text with rich format once it's shown in the TimeLine.</p>
			
			<p>Here you can see an example of the supported Markdown Syntax so you can start playing with it.</p>
			
			<pre>
# You can Put a big header,
## a medium header
### or a small header

This is a new Paragraph
Line jumps does nothing unless you put two of them.

Like this one that creates a second paragraph, also you can
use 1 and 2 asterisks to create **Bold** and *Italics* text.

* You can create list.
* Like this one.

> Quote your favorite artists or maybe a past conversation by
> just by using the '>'' character at the start of the line.</pre>
			<p>Remember you can press <code>ALT+P</code> in the message editor to see a preview of your message.</p>
			
			<p>You can read more about the Markdown syntax in <a href="http://daringfireball.net/projects/markdown/basics">Daring Fireball Page</a>, not all the features listed there will work tough, because we use a limited version of it.</p>
		</div>

		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
		</div>
	</div>


	<!-- Le Scripts -->
	<script type="text/javascript" src="/js/faye-browser-min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="/js/xregexp-min.js"></script>
	<script type="text/javascript" src="/js/utils.js"></script>
	<script type="text/javascript" src="/js/marked.js"></script>
	<script type="text/javascript" src="/js/epiceditor.js"></script>
	<script type="text/javascript" src="/js/keymaster.min.js"></script>
	<!--<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
	<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4e906de04dcb0610"></script>
	AddThis Button END -->
	
	<!-- Our Libraries -->
	<script type="text/javascript" src="/js/frontend_config.js"></script>
	{{if user !== false }}
	<script type="text/javascript" src="/js/engine.js"></script>
	{{/if}}
	<script type="text/javascript" src="/js/room.js"></script>
	{{html ANALYTICS}}
</body>
</html>
