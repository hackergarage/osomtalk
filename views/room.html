<!DOCTYPE html>
<html lang="en">
<head>
	<title>OsomTalk - ${room}</title>

	<link href="/css/bootstrap.css" rel="stylesheet">
	<style>
	body {
		padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
	}
	</style>

	<link href="/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">

	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Fav and touch icons -->
	<link rel="shortcut icon" href="../assets/ico/favicon.ico">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">


	<script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			window.client = new Faye.Client('http://192.168.15.66:8000/faye');

			window.client.subscribe('/messages', function(message) {
				$('#messages').prepend('<div>' + prettyfy(message.text) + '</div>');
			});

				/** 
				 * Send message when plain enter is pressed, on Shift + Enter
				 * adds a new line.
				 **/
				 $('#message_input').bind('keypress', function(e) {
				 	if (e.keyCode == 13 && !e.shiftKey) {
				 		sendMessage();
				 		e.preventDefault();
				 	}
				 });
				});

		function sendMessage() {
			window.client.publish('/messages', {
				text: $('#message_input').val()
			});
			$('#message_input').val('');
			$('#message_input').focus();
		}

		function prettyfy(inputText) {
			var replaceText, replacePattern0, replacePattern1, replacePattern2, replacePattern3;
			
			replacedText = String(inputText).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
		    
		    //URLs starting with http://, https:// and finishing with .png, .jpg .gif or .jpeg
		    replacePattern0 = /(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*\.[gif|png])/gim;
		    replacedText = inputText.replace(replacePattern0, '<img src="$1"/>');

		    //URLs starting with http://, https://, or ftp://
		    replacePattern1 = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
		    replacedText = inputText.replace(replacePattern1, '<a href="$1" target="_blank">$1</a>');

		    //URLs starting with "www." (without // before it, or it'd re-link the ones done above).
		    replacePattern2 = /(^|[^\/])(www\.[\S]+(\b|$))/gim;
		    replacedText = replacedText.replace(replacePattern2, '$1<a href="http://$2" target="_blank">$2</a>');

		    //Change email addresses to mailto:: links.
		    replacePattern3 = /(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim;
		    replacedText = replacedText.replace(replacePattern3, '<a href="mailto:$1">$1</a>');

		    return replacedText
		}
		function htmlEntities(str) {
    		return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
		}
	</script>
</head>   
<body>
	<div class="container">
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="/">OsomTalk</a>
					<div class="nav-collapse collapse">
						<ul class="nav">
							<li><a href="/">Home</a></li>
							<li><a href="#about">About</a></li>
							<li><a href="#contact">Contact</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		

		
		<div class="page-header">
			<h1>${room}</h1>
		</div>
		
		<div class="row-fluid">

			<div class="span4">
				<textarea name="message_input" id="message_input" placeholder="Write Your Message"></textarea>
				<br/>
				<a href="#" onclick="sendMessage()" class="btn btn-primary btn-large">
					Send Message
				</a>
			</div> 
			
			<div class="span8">
				<h2>Messages</h2>
				<div id="messages">

				</div>
			</div>
			
		</div>
		
	</div><!--Container -->
	<script type="text/javascript" src="/js/faye-browser-min.js"></script>
	<script type="text/javascript" src="/js/bootstrap.min.js"></script>
</body>
</html>